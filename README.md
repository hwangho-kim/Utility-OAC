# 제안된 반도체 클린룸 HVAC 시스템 최적화 알고리즘 종합 설명

## 1. 알고리즘 개요

-   **최종 목표:** 클린룸 내부 환경(온도, 습도 등)을 안정적으로 유지하면서 공조 설비 운영에 소요되는 에너지를 절감하고, 설비의 부하 분담을 최적화하여 안정성을 높이는 것입니다.
-   **대상 설비:**
    -   **OAC (Out Air Controller, 공조기):** 14대. 예열, 예냉, 냉각, 승온, 가습 코일 및 FAN으로 구성.
    -   **냉동기:** 저온 냉동기(8대, OAC 냉각 코일 연동) 및 고온 냉동기(8대, OAC 예냉 코일 연동).
    -   **냉각탑:** 9대. 냉동기의 열 부하 처리.

## 2. 핵심 동작 원리 및 구성 요소

알고리즘은 크게 데이터 준비, 예측 모델, 최적화 모델의 세 부분으로 구성됩니다. `CleanroomHVACOptimizer` 클래스를 중심으로 각 기능이 메소드 형태로 구현되어 있습니다.

### 2.1 데이터 준비 및 특징 공학

-   **입력 데이터:** 사용자가 제공한 과거 6개월 운전 데이터와 현재 실시간으로 입력되는 외기 조건(온도, 습도) 및 OAC 설정값(각 코일별 목표 온도, FAN Hz)을 사용합니다.
-   **엔탈피 계산:** 공기의 상태를 정확히 파악하기 위해, 주어진 온도와 습도 데이터를 바탕으로 공기의 엔탈피(kJ/kg)를 계산합니다. 이는 OAC 코일의 부하를 산정하는 데 중요한 지표가 됩니다. (`calculate_humidity_ratio`, `calculate_enthalpy` 유틸리티 함수 사용)

### 2.2 OAC 코일 개도율 예측 모듈 (`predict_oac_coil_opening_ratios` 메소드)

-   **목적:** 현재 외기 조건과 OAC의 각 단계별 설정값에 따라 5개 코일(예열, 예냉, 냉각, 승온, 가습)의 최적 개도율(%)을 예측합니다.
-   **입력:**
    -   현재 외기 조건 (온도, 습도, 계산된 엔탈피).
    -   각 OAC별 코일 설정값 (목표 온도) 및 FAN Hz.
-   **모델:** 각 OAC(14대)별로 독립적인 다중 출력 회귀 모델(Scikit-learn의 `MultiOutputRegressor`와 `RandomForestRegressor` 결합)을 사용합니다. 이 모델은 과거 데이터를 통해 특정 입력 조건에서 어떤 코일 개도율 패턴이 나타났는지 학습합니다.
-   **출력:** 각 OAC의 5개 코일에 대한 예측 개도율 (%).
-   **수동 개도율 수정 기능:** 사용자가 특정 코일의 개도율을 임의로 수정하면, 이 값을 예측 결과에 반영합니다.
    -   **현재 구현:** 수정된 값을 해당 코일의 개도율로 확정하고, 이 변경된 개도율 값을 기반으로 후속 계산(예: 냉동기 부하 예측)이 진행됩니다.
    -   **주의 및 향후 개선:** 현재는 하나의 코일 개도율 변경이 다른 코일들의 개도율에 미치는 물리적 연동 효과(예: 에너지 균형 유지, 제어 목표 재달성)를 자동으로 정교하게 재조정하는 로직은 포함되어 있지 않습니다. 이는 매우 복잡한 문제로, 규칙 기반 시스템, 물리 모델 또는 추가적인 연동 모델 개발이 필요합니다. 현재는 수동 변경 시 "주의" 메시지를 통해 이 점을 알립니다.

### 2.3 냉동기 운전 파라미터 예측 모듈 (`predict_chiller_parameters` 메소드)

-   **목적:** 예측된 OAC 코일 개도율(특히 예냉 코일 및 냉각 코일)과 현재 외기 조건을 바탕으로, 저온 및 고온 냉동기군의 주요 운전 상태(메인 차압, 메인 차압 개도율, 서브 차압 개도율)를 예측하고, 냉동기 부하의 지표가 되는 값을 계산합니다.
-   **입력:**
    -   모든 OAC의 예측된 코일 개도율 (이로부터 `Total_low_Coil_Load_Indicator`, `Total_high_Coil_Load_Indicator` 등 냉동기 부하 관련 지표 생성).
    -   현재 외기 조건 (온도, 습도, 엔탈피).
-   **모델:** 저온 냉동기군과 고온 냉동기군 각각에 대해 별도의 다중 출력 회귀 모델(`RandomForestRegressor` 기반)을 사용합니다.
-   **출력:** 각 냉동기군의 메인 차압, 메인 차압 개도율, 서브 차압 개도율 예측치 및 계산된 총 부하 지표(`calculated_total_load_indicator`).

### 2.4 냉동기 최적 가동 대수 산출 모듈 (`optimize_chiller_operating_units` 메소드)

-   **목적:** 예측된 각 냉동기군(저온/고온)의 총 부하 지표를 바탕으로, 에너지 효율 및 시스템 안정성을 고려하여 최적의 냉동기 가동 대수를 결정합니다.
-   **입력:** `predict_chiller_parameters`로부터 계산된 저온/고온 냉동기 각각의 `calculated_total_load_indicator`.
-   **최적화 전략 (개선된 방식):**
    1.  **설비 특성값 활용:** 각 냉동기의 "정격 용량(`rated_capacity_per_...`)"과 "최적 운전 부하율 범위(`optimal_load_ratio_min/max`, 예: 40%~85%)"를 사전에 정의합니다. (이 값들은 실제 시스템 특성에 맞게 사용자가 설정해야 합니다.)
    2.  **최소 필요 대수 계산:** 먼저, 총 부하를 감당하기 위한 이론적인 최소 가동 대수를 계산합니다.
    3.  **효율적 운전 대수 탐색:** 최소 필요 대수부터 최대 가용 대수(8대)까지 각 가동 대수 시나리오를 평가합니다.
        -   각 시나리오에서 대당 평균 부하율(`총 부하 / (가동 대수 * 정격 용량)`)을 계산합니다.
        -   이 평균 부하율이 과도하게 낮거나(예: < 5~10%, 매우 비효율적) 높지 않으면서(예: > 100%, 과부하), 사전에 정의된 "최적 운전 부하율 범위"에 가장 근접하거나 그 안에 있는 대수를 최적 대수로 선택합니다. 이는 극단적인 부분 부하 운전을 피하고, 여러 대의 장비를 보다 균형 잡힌 부하로 운전시키려는 의도입니다.
-   **출력:** 저온 냉동기 및 고온 냉동기의 최적 가동 예상 대수.

### 2.5 냉각탑 최적 가동 대수 산출 모듈 (`optimize_cooling_tower_operating_units` 메소드)

-   **목적:** 최적으로 결정된 냉동기 가동 상태(대수 및 부하량)를 기반으로 냉각탑의 최적 가동 대수를 결정합니다.
-   **입력:**
    -   `optimize_chiller_operating_units`로부터 산출된 최적 냉동기 가동 대수.
    -   `predict_chiller_parameters`로부터 산출된 냉동기 부하 지표.
-   **부하 계산:** 가동 중인 냉동기들의 총 열 방출량을 추정합니다. 이는 각 냉동기의 부하 지표에 COP(성능계수, 여기서는 평균 4.0 가정)를 고려한 변환 계수(예: $Q_{reject} = Q_{evap} \cdot (1 + 1/COP)$)를 적용하여 계산합니다.
-   **최적화 전략:** 냉동기와 유사하게, 냉각탑의 "정격 용량(`rated_heat_rejection_per_ct`)" 및 "최적 운전 부하율 범위"를 고려하여, 추정된 총 열 방출 부하에 가장 적합한 냉각탑 가동 대수를 결정합니다.
-   **출력:** 냉각탑 최적 가동 예상 대수.

## 3. 데이터 활용 및 모델 학습

-   **과거 데이터 학습:** 제공된 6개월간의 1초 단위 운전 데이터를 (현재 코드는 1시간 단위로 리샘플링된 더미 데이터 사용) 활용하여 OAC 코일 개도율 예측 모델과 냉동기 파라미터 예측 모델(모두 `RandomForestRegressor` 기반)을 학습합니다.
-   **현실성 있는 더미 데이터 생성:** 알고리즘 테스트 및 다양한 시나리오 분석을 위해, 실제 데이터의 특성(계절성, 일일 변화, 설비 간 연관성, 노이즈)을 모방한 1시간 단위 더미 데이터를 생성하는 로직이 포함되어 있습니다. (`if __name__ == '__main__':` 블록 내)

## 4. 주요 특징 및 사용자 요구사항 반영

-   외기 조건 및 OAC 설정값 기반 코일 개도율 예측.
-   냉동기 운전 파라미터(차압, 개도율) 예측.
-   최적화 기법을 이용한 냉동기 및 냉각탑 가동 대수 산출 (단순 최소 대수 산정 방식 개선).
-   엔탈피 기반 분석 지원 (데이터 준비 단계에서 엔탈피 계산).
-   제공된 피처만을 사용한 Python 구현.

## 5. 한계점 및 향후 개선 방향

-   최적화 로직에서의 "효율성"은 실제 설비의 전력 소비량 데이터나 상세한 성능 곡선(COP 곡선, 부분 부하 효율 곡선) 없이, 일반적인 운전 경향을 가정한 규칙(최적 부하율 범위)에 기반합니다. 실제 에너지 절감 효과를 극대화하기 위해서는 이러한 상세 데이터 반영이 필요합니다.
-   OAC 코일 개도율 수동 변경 시, 다른 코일들의 정교한 자동 연동 조정 로직은 매우 복잡하여 추가적인 심도 있는 개발(물리 모델, 규칙 기반 시스템, 또는 전용 연동 모델)이 필요합니다.
-   설비의 최소 가동/정지 시간, 기동 순서, 예비 설비 운영 정책 등 실제 현장의 다양한 운영 제약 조건은 현재 알고리즘에 상세히 반영되어 있지 않습니다.
-   `rated_capacity_per_...`, `optimal_load_ratio_min/max`와 같은 파라미터들은 실제 시스템의 설계 사양과 운전 특성에 맞게 정확히 설정되거나 데이터로부터 정교하게 추정되어야 알고리즘의 실효성이 높아집니다.
-   사용된 `RandomForestRegressor` 모델의 하이퍼파라미터 튜닝, 피처 엔지니어링 심화, 또는 다른 종류의 머신러닝/딥러닝 모델(LSTM, GRU 등 시계열 특화 모델) 적용을 통해 예측 정확도를 더욱 향상시킬 수 있습니다.

본 알고리즘은 반도체 클린룸 HVAC 시스템의 복잡성을 고려한 지능형 운영을 위한 강력한 출발점이며, 지속적인 데이터 분석, 모델 검증 및 시스템 특성 반영을 통해 현장에 최적화된 솔루션으로 발전시켜 나갈 수 있을 것입니다.
